<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Write Your First Kernel Module | Zephyr</title>
    <meta name="description" content="A Java Plugin System for the 21st Century">
    
    
    <link rel="preload" href="/assets/css/0.styles.eb92a25b.css" as="style"><link rel="preload" href="/assets/js/app.43ec8c7a.js" as="script"><link rel="preload" href="/assets/js/2.74d37b0c.js" as="script"><link rel="preload" href="/assets/js/14.3d21ecd8.js" as="script"><link rel="prefetch" href="/assets/js/10.4114b15b.js"><link rel="prefetch" href="/assets/js/11.7630c02c.js"><link rel="prefetch" href="/assets/js/12.a2534e64.js"><link rel="prefetch" href="/assets/js/13.af1529ad.js"><link rel="prefetch" href="/assets/js/15.444cd55e.js"><link rel="prefetch" href="/assets/js/16.22291763.js"><link rel="prefetch" href="/assets/js/3.497da5b4.js"><link rel="prefetch" href="/assets/js/4.7131115d.js"><link rel="prefetch" href="/assets/js/5.db84c825.js"><link rel="prefetch" href="/assets/js/6.1970a481.js"><link rel="prefetch" href="/assets/js/7.22c3fed2.js"><link rel="prefetch" href="/assets/js/8.e7dae5da.js"><link rel="prefetch" href="/assets/js/9.44f55cd6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eb92a25b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/wind-duotone.svg" alt="Zephyr" class="logo"> <span class="site-name can-hide">Zephyr</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://zephyr.sunshower.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/sunshower-io/zephyr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Repository
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://zephyr.sunshower.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/sunshower-io/zephyr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Repository
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Overview</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Get started</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/get-started/running.html" class="sidebar-link">Installing Zephyr</a></li><li><a href="/get-started/modules-and-plugins.html" class="sidebar-link">Installing Plugins and Modules</a></li><li><a href="/get-started/write-kernel-module.html" class="active sidebar-link">Write Your First Kernel Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/get-started/write-kernel-module.html#a-basic-build-gradle" class="sidebar-link">A basic build.gradle</a></li><li class="sidebar-sub-header"><a href="/get-started/write-kernel-module.html#the-basics-of-implementing-an-entrypoint" class="sidebar-link">The basics of implementing an EntryPoint</a></li><li class="sidebar-sub-header"><a href="/get-started/write-kernel-module.html#handling-localization" class="sidebar-link">Handling localization</a></li><li class="sidebar-sub-header"><a href="/get-started/write-kernel-module.html#registering-an-entrypoint" class="sidebar-link">Registering an EntryPoint</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kernel</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="write-your-first-kernel-module"><a href="#write-your-first-kernel-module" class="header-anchor">#</a> Write Your First Kernel Module</h1> <p>Kernel modules alter the basic behavior of Zephyr. This example is based on <code>zephyr-logging</code>, which modifies the default Java logging behavior.</p> <h2 id="a-basic-build-gradle"><a href="#a-basic-build-gradle" class="header-anchor">#</a> A basic build.gradle</h2> <p>You'll want to depend on <code>kernel-core</code> and <code>kernel-api</code>, as well as <code>kernel-tests</code>.</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">'java'</span>
apply plugin<span class="token punctuation">:</span> <span class="token string">'java-library'</span>
dependencies <span class="token punctuation">{</span>

    <span class="token punctuation">[</span>
            <span class="token string">'info.picocli:picocli'</span><span class="token punctuation">,</span>
            <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">':kernel-api'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">':kernel-core'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token operator">.</span>each <span class="token punctuation">{</span>
        implementation it
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span>
            <span class="token function">project</span><span class="token punctuation">(</span><span class="token string">':kernel-tests:kernel-test-common'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token operator">.</span>each <span class="token punctuation">{</span>
        testImplementation it
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="the-basics-of-implementing-an-entrypoint"><a href="#the-basics-of-implementing-an-entrypoint" class="header-anchor">#</a> The basics of implementing an EntryPoint</h2> <p><code>io.zephyr.kernel.extensions.EntryPoint</code> is the bread-and-butter of extending Zephyr.
<code>getLogger()</code> is simple enough -- you provide a logger for the class. In most cases, you'll want the logger to be a field in the class
<code>getOptions()</code> lets you get the options LogEntryPoint are initialized with. <code>io.zephyr.kernel.Options</code> can be implemented to allow you to pass in args from the command line.
<code>getPriority()</code> is used to determine the start order of a kernel module. The smaller the int, the higher the priority.
<code>initialize()</code> is called by the KernelLauncher to initialize the module with Zephyr's context.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogEntryPoint</span> <span class="token keyword">implements</span> <span class="token class-name">EntryPoint</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Options</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextEntries</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="accepting-cli-arguments"><a href="#accepting-cli-arguments" class="header-anchor">#</a> Accepting CLI arguments</h3> <p>You can accept options from the CLI within <code>initialize()</code>. First, you need to implement <code>io.zephyr.kernel.Options</code>.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogOptions</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractValidatable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogOptions</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Options</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogOptions</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

  <span class="token comment">/**
   * Specify the home directory for Zephyr. Zephyr logs are stored here. For clustered Zephyr
   * kernels, this should be a distributed directory unless a data-distribution module is installed
   */</span>
  <span class="token annotation punctuation">@Getter</span>
  <span class="token annotation punctuation">@Setter</span>
  <span class="token annotation punctuation">@CommandLine</span><span class="token punctuation">.</span><span class="token class-name">Option</span><span class="token punctuation">(</span>
    names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;-h&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--home-directory&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    defaultValue <span class="token operator">=</span> <span class="token string">&quot;zephyr&quot;</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">File</span> homeDirectory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can then tweak <code>getOptions()</code> to return your new class.</p> <div class="language-java extra-class"><pre class="language-java"><code>   <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogEntryPoint</span> <span class="token keyword">implements</span> <span class="token class-name">EntryPoint</span> <span class="token punctuation">{</span>
    
     <span class="token keyword">private</span> <span class="token class-name">LogOptions</span> options<span class="token punctuation">;</span>
   
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
     
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token class-name">LogOptions</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> options<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextEntries</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre></div><p>Finally, as the first step in <code>initialize()</code>, you can create and set your new options.</p> <div class="language-java extra-class"><pre class="language-java"><code>     <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogEntryPoint</span> <span class="token keyword">implements</span> <span class="token class-name">EntryPoint</span> <span class="token punctuation">{</span>
      
       <span class="token keyword">private</span> <span class="token class-name">LogOptions</span> options<span class="token punctuation">;</span>
     
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
       
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token class-name">LogOptions</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> options<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
     
       <span class="token annotation punctuation">@Override</span>
       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextEntries</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           options <span class="token operator">=</span> <span class="token class-name">Options</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">LogOptions</span><span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre></div><h3 id="initializing-a-kernel-module"><a href="#initializing-a-kernel-module" class="header-anchor">#</a> Initializing a kernel module</h3> <p>The <code>initialize()</code> method gets called by the KernelLauncher, and does the heavy lifting for setting up your kernel module.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>zephyr<span class="token punctuation">.</span>common</span><span class="token punctuation">.</span><span class="token class-name">Options</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>zephyr<span class="token punctuation">.</span>kernel<span class="token punctuation">.</span>extensions</span><span class="token punctuation">.</span><span class="token class-name">EntryPoint</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>zephyr<span class="token punctuation">.</span>kernel<span class="token punctuation">.</span>log</span><span class="token punctuation">.</span><span class="token class-name">Logging</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>logging</span><span class="token punctuation">.</span><span class="token class-name">FileHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>logging</span><span class="token punctuation">.</span><span class="token class-name">Level</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>logging</span><span class="token punctuation">.</span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>val</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogEntryPoint</span> <span class="token keyword">implements</span> <span class="token class-name">EntryPoint</span> <span class="token punctuation">{</span>

  <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">Logging</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">LogEntryPoint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token class-name">LogOptions</span> options<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Logger</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> log<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextEntries</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> <span class="token class-name">Options</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">LogOptions</span><span class="token operator">:</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token function">getHomeDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      val logdir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token function">getHomeDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsoluteFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>logdir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>logdir<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          log<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span>SEVERE<span class="token punctuation">,</span> <span class="token string">&quot;log.entrypoint.mkdir.failed&quot;</span><span class="token punctuation">,</span> logdir<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      val logpattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>logdir<span class="token punctuation">,</span> <span class="token string">&quot;zephyr.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Logger</span> root <span class="token operator">=</span> <span class="token function">getRootAndClearHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        val handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileHandler</span><span class="token punctuation">(</span>logpattern<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        handler<span class="token punctuation">.</span><span class="token function">setFormatter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LogFormatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span>SEVERE<span class="token punctuation">,</span> <span class="token string">&quot;log.entrypoint.configuration.failed&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span>SEVERE<span class="token punctuation">,</span> <span class="token string">&quot;log.entrypoint.configuration.failed.ex&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Logger</span> <span class="token function">getRootAndClearHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val logger <span class="token operator">=</span> <span class="token function">getRootLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    val handlers <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">getHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>val handler <span class="token operator">:</span> handlers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">removeHandler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> logger<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Logger</span> <span class="token function">getRootLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Logger</span> logger<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>logger <span class="token operator">=</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> logger<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> logger <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> logger<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">LogOptions</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> options<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">EntryPoint</span><span class="token punctuation">.</span>HIGHEST_PRIORITY <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="handling-localization"><a href="#handling-localization" class="header-anchor">#</a> Handling localization</h2> <p>Logging should be localized.
To do this, pass a name-spaced string to your logging method, and set up a corresponding string in the i18n properties file for the class.
The file should be in <code>src/main/resources/i18n/</code>, and then nested in directories to reflect the package name.
In this case, the directory for our logging localization is <code>io/zephyr/logging/</code>.
Because our EntryPoint's class name is LogEntryPoint and we're working in American English, we create the file <code>LogEntryPoint_en_US.properties</code>
Then we make an entry for each of our three logging messages in the class:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">log.entrypoint.mkdir.failed</span><span class="token punctuation">=</span><span class="token attr-value">Could not make log directory ''{{0}}''</span>
<span class="token attr-name">log.entrypoint.configuration.failed</span><span class="token punctuation">=</span><span class="token attr-value">Failed to configure logging. Reason: {{0}}</span>
<span class="token attr-name">log.entrypoint.configuration.failed.ex</span><span class="token punctuation">=</span><span class="token attr-value">Full cause: {{0}}</span>
</code></pre></div><h2 id="registering-an-entrypoint"><a href="#registering-an-entrypoint" class="header-anchor">#</a> Registering an EntryPoint</h2> <p>The final step to getting your kernel module to build is registering it as a service in <code>src/main/resources/META-INF/services</code>.
Create a file named the zephyr extension you're using. In this case: <code>io.zephyr.kernel.extensions.EntryPoint</code>.
The content of the file should simply be the class you're providing that implements that extension: <code>io.zephyr.logging.LogEntryPoint</code>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/get-started/modules-and-plugins.html" class="prev">Installing Plugins and Modules</a></span> <span class="next"><a href="/kernel/extension-points.html">Kernel Extension Points</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.43ec8c7a.js" defer></script><script src="/assets/js/2.74d37b0c.js" defer></script><script src="/assets/js/14.3d21ecd8.js" defer></script>
  </body>
</html>
