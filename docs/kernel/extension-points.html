<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kernel Extension Points | Zephyr</title>
    <meta name="description" content="A Java Plugin System for the 21st Century">
    
    
    <link rel="preload" href="/assets/css/0.styles.3d781237.css" as="style"><link rel="preload" href="/assets/js/app.12ec3585.js" as="script"><link rel="preload" href="/assets/js/2.74d37b0c.js" as="script"><link rel="preload" href="/assets/js/16.24fdb518.js" as="script"><link rel="prefetch" href="/assets/js/10.ad6525a3.js"><link rel="prefetch" href="/assets/js/11.2d5e438a.js"><link rel="prefetch" href="/assets/js/12.96dd25d7.js"><link rel="prefetch" href="/assets/js/13.993e1e63.js"><link rel="prefetch" href="/assets/js/14.3b65735b.js"><link rel="prefetch" href="/assets/js/15.ea067a2d.js"><link rel="prefetch" href="/assets/js/17.70820bc3.js"><link rel="prefetch" href="/assets/js/18.3f22692c.js"><link rel="prefetch" href="/assets/js/19.144cbd38.js"><link rel="prefetch" href="/assets/js/3.8ff8835f.js"><link rel="prefetch" href="/assets/js/4.e6b40633.js"><link rel="prefetch" href="/assets/js/5.ef0b6ff1.js"><link rel="prefetch" href="/assets/js/6.3fa0cae3.js"><link rel="prefetch" href="/assets/js/7.a465dd32.js"><link rel="prefetch" href="/assets/js/8.ab363e69.js"><link rel="prefetch" href="/assets/js/9.7c87c9c4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3d781237.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/wind-duotone.svg" alt="Zephyr" class="logo"> <span class="site-name can-hide">Zephyr</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/sunshower-io/zephyr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Get Zephyr
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/sunshower-io/zephyr" target="_blank" rel="noopener noreferrer" class="repo-link">
    Get Zephyr
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Overview</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Concepts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Get-started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kernel</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kernel/extension-points.html" class="active sidebar-link">Kernel Extension Points</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kernel/extension-points.html#kernel-entry-points" class="sidebar-link">Kernel Entry Points</a></li><li class="sidebar-sub-header"><a href="/kernel/extension-points.html#kernel-modules" class="sidebar-link">Kernel Modules</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Lifecycle</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Plugins</span> <!----></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kernel-extension-points"><a href="#kernel-extension-points" class="header-anchor">#</a> Kernel Extension Points</h1> <p>Zephyr was designed with extreme extensibility and customizability in mind.  Zephyr's internal behaviors can be
modified in a variety of ways, including <code>plugins</code> , <code>kernel entry points</code>, and <code>kernel modules</code></p> <h2 id="kernel-entry-points"><a href="#kernel-entry-points" class="header-anchor">#</a> Kernel Entry Points</h2> <p>Kernel Entry Points are the lowest-level mechanism to extend or modify Zephyr's internal behavior.  Kernel Entry Points
are added to the <code>$ZEPHYR_HOME/lib</code> directory, and so are available on the System classloader, in contrast to the other mechanisms.</p> <h3 id="the-kernel-entry-point-api"><a href="#the-kernel-entry-point-api" class="header-anchor">#</a> The Kernel Entry Point API</h3> <p>To modify Kernel behaviors, you must implement some portion of the Kernel <code>EntryPoint</code> API, defined in <code>kernel-api</code>.</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EntryPoint</span> <span class="token keyword">extends</span> <span class="token class-name">PrioritizedExtension</span><span class="token punctuation">,</span> <span class="token class-name">Startable</span><span class="token punctuation">,</span> <span class="token class-name">Stoppable</span> <span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">ContextEntries</span> <span class="token punctuation">{</span>
    ARGS<span class="token punctuation">,</span>
    ENTRY_POINTS<span class="token punctuation">,</span>
    ENTRY_POINTS_TEMP<span class="token punctuation">,</span>
    KERNEL_EXECUTOR_SERVICE<span class="token punctuation">,</span>
    ENTRY_POINT_REGISTRY<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Logger</span> <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextEntries</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextEntries</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token string">&quot;entry point starting...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span>INFO<span class="token punctuation">,</span> <span class="token string">&quot;entry point stopping...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">default</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;Empty Entry Point contains no services&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">default</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">boolean</span> <span class="token keyword">exports</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextEntries</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token class-name">Options</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>An <code>EntryPoint</code> may obtain the parameters used to start the Zephyr process via the <code>context</code> map supplied to <code>initialize</code> and
use them to modify its behavior, ideally creating and supplying an implementation of <code>io.zephyr.kernel.Options</code> ( <a href="https://picocli.info" target="_blank" rel="noopener noreferrer">Picocli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is available
as an <code>EntryPoint</code> by default.)</p> <p>EntryPoints may provide additional Zephyr Shell commands, modify the shell, modify the internal concurrency mechanisms, alter logging, and many other things.</p> <h4 id="entry-point-concurrency"><a href="#entry-point-concurrency" class="header-anchor">#</a> Entry Point Concurrency</h4> <p>Each EntryPoint is run asynchronously relative to the main Zephyr thread, but does not guarantee a unique ThreadLocal context.  Implementors should
use concurrency with caution.  Zephyr supplies an ExecutorService, available in the context under the key <code>KERNEL_EXECUTOR_SERVICE</code>.  Any tasks scheduled on the ExecutorService
must complete before <code>stop</code> is exited.</p> <p>EntryPoint's <code>initialize</code> and <code>finalize</code> methods must not block for long periods.  However, <code>run</code> may block for as long as it needs to, but should
honor OS shutdown requests.</p> <p>Finally, EntryPoints do not need to be thread-safe.</p> <h4 id="entry-point-order"><a href="#entry-point-order" class="header-anchor">#</a> Entry Point Order</h4> <p>The kernel launcher is itself an entry point, and has priority <code>MAX_PRIORITY - 10</code>, allowing other entry points to preempt it.
Preempting the launcher should be done with care, if at all.</p> <h2 id="kernel-modules"><a href="#kernel-modules" class="header-anchor">#</a> Kernel Modules</h2> <p>Once Zephyr has scheduled and executed all available entry points, <code>kernel modules</code> are loaded and executed.  All
kernel modules reside in the <code>kernel classloader</code>, which is an optional predecessor to any <a href="/concepts/classpath.html">plugin classloader graph</a></p> <p>Kernel modules don't have a defined lifecycle, and generally exist to supply various Java <code>Service Provider Interfaces</code> that modify the kernel's capabilities for interacting with
plugins.  For instance, to define a new packaging format, a kernel module may implement the <code>io.zephyr.kernel.extensions.ModuleAssemblyExtractor</code> API.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ModuleAssemblyExtractor</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">extract</span><span class="token punctuation">(</span><span class="token class-name">Assembly</span> assembly<span class="token punctuation">,</span> <span class="token class-name">FileSystem</span> moduleFilesystem<span class="token punctuation">,</span> <span class="token class-name">ExtractionListener</span> listener<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

  <span class="token keyword">interface</span> <span class="token class-name">ExtractionListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">beforeEntryExtracted</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">afterEntryExtracted</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="kernel-module-concurrency"><a href="#kernel-module-concurrency" class="header-anchor">#</a> Kernel Module Concurrency</h3> <p>Kernel modules are safely and concurrently executed on the Gyre, and do not require any internal thread-safety mechanisms.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/get-started/running.html" class="prev">Installation</a></span> <span class="next"><a href="/shell/commands.html">Zephyr Shell</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.12ec3585.js" defer></script><script src="/assets/js/2.74d37b0c.js" defer></script><script src="/assets/js/16.24fdb518.js" defer></script>
  </body>
</html>
